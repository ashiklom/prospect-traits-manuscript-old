# Methods

## Data

```{r setup-methods}

site_info <- readRDS('site_info.rds')

```

```{r sitemap, fig.cap = sitemap_cap}

sitemap_cap <- paste('Sample distribution in geographic and climate space')

sitemap_dat <- tbl(specdb, 'samples') %>%
    left_join(tbl(specdb, 'plots') %>% select(plotcode, sitecode)) %>%
    left_join(tbl(specdb, 'sites')) %>%
    collect %>%
    left_join(site_info) %>%
    count(sitecode, site_lat, site_lon, temp, prec, projectcode)

x_lims <- round(range(sitemap_dat$site_lon, na.rm = TRUE))
y_lims <- round(range(sitemap_dat$site_lat, na.rm = TRUE))
ggplot(sitemap_dat) + 
    aes(x = site_lon, y = site_lat, size = n, color = projectcode) +
    borders('world', xlim = x_lims, ylim = y_lims) +
    geom_point()

ggplot(sitemap_dat) + 
    aes(x = temp, y = prec, size = n, color = projectcode) + 
    geom_point()

```

## Inversion approach

Bayesian inversion of PROSPECT [@shiklomanov_quantifying_2016]. 

## Statistical analysis

PCA on residuals, following @roth_leaf_2016 .

TODO:
    * Calculate some 'T-statistics', following @violle_return_2012 ?

